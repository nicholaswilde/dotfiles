#!/bin/bash

# Colors
if command_exists tput; then
  # foreground
  RED=$(tput setaf 1)
  GREEN=$(tput setaf 2)
  YELLOW=$(tput setaf 3)
  BLUE=$(tput setaf 4)
  MAGENTA=$(tput setaf 5)
  CYAN=$(tput setaf 6)
  WHITE=$(tput setaf 7)
  GRAY=$(tput setaf 8)
  DARKRED=$(tput setaf 9)
  DARKGREEN=$(tput setaf 10)
  DARKYELLOW=$(tput setaf 11)
  DARKBLUE=$(tput setaf 12)
  DARKMAGENTA=$(tput setaf 13)
  DARKCYAN=$(tput setaf 14)
  DARKWHITE=$(tput setaf 15)
  BLINK=$(tput blink)
  NORMAL=$(tput sgr0)
  BOLD=$(tput bold)
  # background
  BGRED=$(tput setab 1)
  BGGREEN=$(tput setab 2)
  BGYELLOW=$(tput setab 3)
  BGBLUE=$(tput setab 4)
  BGMAGENTA=$(tput setab 5)
  BGCYAN=$(tput setab 6)
  BGWHITE=$(tput setab 7)
  BGGRAY=$(tput setab 8)
  BGDARKRED=$(tput setab 9)
  BGDARKGREEN=$(tput setab 10)
  BGDARKYELLOW=$(tput setab 11)
  BGDARKBLUE=$(tput setab 12)
  BGDARKMAGENTA=$(tput setab 13)
  BGDARKCYAN=$(tput setab 14)
  BGDARKWHITE=$(tput setab 15)
  export RED GREEN YELLOW BLUE MAGENTA CYAN WHITE GRAY BLINK NORMAL BOLD
  export DARKRED DARKGREEN DARKYELLOW DARKBLUE DARKMAGENTA DARKCYAN DARKWHITE
  export BGRED BGGREEN BGYELLOW BGBLUE BGMAGENTA BGCYAN BGWHITE BGGRAY
  export BGDARKRED BGDARKGREEN BGDARKYELLOW BGDARKBLUE BGDARKMAGENTA BGDARKCYAN BGDARKWHITE
fi

# History blue
# HISTTIMEFORMAT=$(echo -e "${BLUE}"%F %T "${NORMAL}")

# don't put duplicate lines or lines starting with space in the history.
# See bash(1) for more options
HISTCONTROL=ignoreboth

# append to the history file, don't overwrite it
shopt -s histappend

# for setting history length see HISTSIZE and HISTFILESIZE in bash(1)
HISTSIZE=1000
HISTFILESIZE=2000
export HISTTIMEFORMAT HISTSIZE HISTFILESIZE

export DEBIAN_FRONTEND=noninteractive

# colored GCC warnings and errors
command_exists gcc && export GCC_COLORS='error=01;31:warning=01;35:note=01;36:caret=01;32:locus=01:quote=01'

# go
test -d "${HOME}/go" && export GOPATH="${HOME}/go"
test -d /usr/local/go/ && export GOROOT=/usr/local/go/

# kubectl
test -f "${HOME}/.kube/config-turing-pi" && export KUBECONFIG="${HOME}/.kube/config-turing-pi"

# Default editor
export EDITOR='micro'
export VISUAL=${EDITOR}
export KUBE_EDITOR=${EDITOR}

# git
export GITHUB_USER=nicholaswilde

# For boilerplater
export AUTHOR_NAME="Nicholas Wilde"
export AUTHOR_GPG_KEY="0xb299a622"

export GIT_PATH="${HOME}/git"
export GIT_USER_PATH="${GIT_PATH}/${GITHUB_USER}"

# LastPass
export LPASS_DISABLE_PINENTRY=1

# Tokens
# shellcheck source=/dev/null
test -f "${HOME}/.tokens" && source "${HOME}/.tokens"

# pass-git-helper
GPG_TTY=$(tty)
export GPG_TTY

# https://www.commandlinefu.com/commands/view/1560/set-cdpath-to-ease-navigation
if [[ ! -d /etc/pve ]]; then
  export CDPATH=:..:~
  test -d "${GIT_USER_PATH}" && export CDPATH="${CDPATH}:${GIT_USER_PATH}"
  test -d "${GIT_PATH}" && export CDPATH="${CDPATH}:${GIT_PATH}"
else
  unset CDPATH
fi

# texlive
test -d /usr/local/texlive/2020/texmf-dist/doc/man && export MANPATH=/usr/local/texlive/2020/texmf-dist/doc/man
test -d INFOPATH=/usr/local/texlive/2020/texmf-dist/doc/info && export INFOPATH=/usr/local/texlive/2020/texmf-dist/doc/info

# PATH
test -d "/home/linuxbrew/.linuxbrew" && export PATH="/home/linuxbrew/.linuxbrew/bin:${PATH}"
test -d "${HOME}/.linuxbrew" && export PATH="${HOME}/.linuxbrew/bin:${PATH}"
test -d "${GOPATH}/bin" && export PATH="${PATH}:${GOPATH}/bin"
test -d "${GOROOT}/bin" && export PATH="${PATH}:${GOROOT}/bin"
test -d "${HOME}/.krew}/bin" && export PATH="${PATH}:${KREW_ROOT:-${HOME}/.krew}/bin"
test -d "${HOME}/.local/bin" && export PATH="${PATH}:${HOME}/.local/bin"
test -d "${HOME}/bin/" && export PATH="${PATH}:${HOME}/bin/"
test -d "${HOME}/.rbenv/bin" && export PATH="${PATH}:${HOME}/.rbenv/bin"
test -d "/usr/local/texlive/2020/bin/x86_64-linux" && export PATH="${PATH}:/usr/local/texlive/2020/bin/x86_64-linux"
test -d "${HOME}/.local/share/mise/shims" && export PATH="${PATH}:${HOME}/.local/share/mise/shims"

test -f "${HOME}/.bashrc" && export BASHRC_PATH="${HOME}/.bashrc" 
test -f "${HOME}/.bash_aliases" && export ALIASES_PATH="${HOME}/.bash_aliases" 
test -f "${HOME}/.bash_completions" && export COMPLETIONS_PATH="${HOME}/.bash_completions" 
test -f "${HOME}/.bash_exports" && export EXPORTS_PATH="${HOME}/.bash_exports" 
test -f "${HOME}/.bash_functions" && export FUNCTIONS_PATH="${HOME}/.bash_functions" 

export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")" 
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# suppress punycode deprecation warning
export NODE_OPTIONS="--no-deprecation"
export MICRO_TRUECOLOR=1

export CHEAT_PERSONAL_PATH="/mnt/storage/cheat/cheatsheets/personal"

# https://github.com/catppuccin/lazygit/tree/c24895902ec2a3cb62b4557f6ecd8e0afeed95d5/themes-mergable/mocha
LG_CONF="${HOME}/.config/lazygit/config.yml"
LG_THEME="${HOME}/.config/lazygit/lavender.yml"

if command_exists lazygit && [[ -f "${LG_CONF}" && -f "${LG_THEME}" ]]; then
  export LG_CONFIG_FILE="${LG_CONF},${LG_THEME}"
fi

# https://github.com/catppuccin/fzf/blob/7c2e05606f2e75840b1ba367b1f997cd919809b3/themes/catppuccin-fzf-mocha.sh
if command_exists fzf; then
  export FZF_DEFAULT_OPTS=" \
    --color=bg+:#313244,bg:#1E1E2E,spinner:#F5E0DC,hl:#F38BA8 \
    --color=fg:#CDD6F4,header:#F38BA8,info:#CBA6F7,pointer:#F5E0DC \
    --color=marker:#B4BEFE,fg+:#CDD6F4,prompt:#CBA6F7,hl+:#F38BA8 \
    --color=selected-bg:#45475A \
    --color=border:#6C7086,label:#CDD6F4"
fi

if command_exists task; then
  # Catppuccin Mocha Colors for go-task
  # Format: 38;2;R;G;B
  
  # Red (Errors) -> Mocha Red
  export TASK_COLOR_RED="38;2;243;139;168"
  
  # Green (Success) -> Mocha Green
  export TASK_COLOR_GREEN="38;2;166;227;161"
  
  # Yellow (Warnings/Progress) -> Mocha Yellow
  export TASK_COLOR_YELLOW="38;2;249;226;175"
  
  # Blue (Info/Summary) -> Mocha Blue
  export TASK_COLOR_BLUE="38;2;137;180;250"
  
  # Magenta (Headers/Titles) -> Mocha Mauve
  export TASK_COLOR_MAGENTA="38;2;203;166;247"
  
  # Cyan (Special/Debug) -> Mocha Teal
  export TASK_COLOR_CYAN="38;2;148;226;213"
  
  # Bright Red (Critical Errors) -> Mocha Pink (for contrast against normal red)
  export TASK_COLOR_BRIGHT_RED="38;2;245;194;231"
  
  # Bright Green -> Mocha Sky (for variety)
  export TASK_COLOR_BRIGHT_GREEN="38;2;137;220;235"
fi

if command_exists gh; then
  export GLAMOUR_STYLE="$HOME/.config/glamour/catppuccin-mocha.json"
fi

# Fix whiptail readability (High Contrast Yellow)
if [[ -f "$HOME/.catppuccin_active" ]]; then
  # Catppuccin Mocha for whiptail (High Contrast Yellow)
  export NEWT_COLORS="
    root=,black \
    window=white,black \
    border=blue,black \
    shadow=black,black \
    title=cyan,black \
    button=black,cyan \
    actbutton=white,red \
    checkbox=blue,black \
    actcheckbox=black,yellow \
    listbox=white,black \
    actlistbox=black,yellow \
    textbox=, \
    acttextbox=black,cyan \
    helpline=, \
    roottext=,"
fi

# SOPS
if command_exists sops; then
  if [[ -f "${HOME}/.config/sops/age/keys.txt" ]]; then
    export SOPS_AGE_KEY_FILE="${HOME}/.config/sops/age/keys.txt"
  fi
fi

# restic
if command_exists restic; then
  export RESTIC_REPOSITORY="/srv/restic-repo"
fi

# https://github.com/josh/restic-age-key
if command_exists restic-age-key; then
  if [[ -d "${RESTIC_REPOSITORY}" ]]; then
    export RESTIC_PASSWORD_COMMAND="restic-age-key password"
    if [[ -n "$SOPS_AGE_KEY_FILE" ]]; then
      export RESTIC_AGE_IDENTITY_FILE="${SOPS_AGE_KEY_FILE}"
    else
      if [[ -f "${HOME}/.config/sops/age/keys.txt" ]]; then
        export RESTIC_AGE_IDENTITY_FILE="${HOME}/.config/sops/age/keys.txt"
      fi
    fi
  fi
fi

if command_exists eget; then
  export EGET_BIN=$HOME/.local/bin
fi
